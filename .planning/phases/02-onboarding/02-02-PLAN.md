---
phase: 02-onboarding
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - skills/onboard/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Running /director:onboard on a project with existing code spawns the mapper agent to analyze the codebase"
    - "Mapper findings are presented to the user in plain language before the interview begins"
    - "User is asked to confirm or correct the mapper findings"
    - "Brownfield interview asks about what to CHANGE, not what to BUILD"
    - "Brownfield interview skips questions the mapper already answered (tech stack, architecture)"
    - "Brownfield vision uses delta format (what exists + what to change) for desired modifications"
    - "VISION.md for brownfield projects captures both current state and desired changes"
  artifacts:
    - path: "skills/onboard/SKILL.md"
      provides: "Complete onboarding workflow with both greenfield and brownfield paths"
      contains: "## Brownfield"
      min_lines: 150
  key_links:
    - from: "skills/onboard/SKILL.md"
      to: "agents/director-mapper.md"
      via: "Task tool spawns mapper as sub-agent for codebase analysis"
      pattern: "director-mapper"
    - from: "skills/onboard/SKILL.md"
      to: "skills/onboard/templates/vision-template.md"
      via: "Brownfield vision follows same template with additional context about existing state"
      pattern: "vision-template"
---

<objective>
Add full brownfield (existing project) onboarding support to the onboard skill, including mapper sub-agent spawning, findings presentation, and an adapted interview that uses delta format for changes.

Purpose: Many vibe coders start Director on projects that already have code. The brownfield path maps what exists, presents it clearly, then asks what the user wants to change -- a fundamentally different experience from the greenfield interview.

Output: An updated `skills/onboard/SKILL.md` with the brownfield placeholder replaced by a fully functional brownfield workflow including mapper spawning, findings presentation, and adapted interview.
</objective>

<execution_context>
@/Users/noahrasheta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/noahrasheta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-onboarding/02-RESEARCH.md
@.planning/phases/02-onboarding/02-01-SUMMARY.md

# Source files to read before implementing
@skills/onboard/SKILL.md
@agents/director-mapper.md
@agents/director-interviewer.md
@skills/onboard/templates/vision-template.md
@reference/context-management.md
@reference/terminology.md
@reference/plain-language-guide.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace brownfield placeholder with mapper spawning and findings presentation</name>
  <files>skills/onboard/SKILL.md</files>
  <action>
Read the current skills/onboard/SKILL.md (which now has the greenfield workflow from Plan 02-01). Find the brownfield placeholder section and replace it with the full brownfield workflow.

**Replace the brownfield placeholder with these sections:**

**Brownfield Detection (update existing)**
The detection logic from Plan 01 already checks for existing source files (package.json, requirements.txt, go.mod, Cargo.toml, Gemfile, src/, app/, lib/, pages/ directories). Keep that detection but remove the "coming soon" message. When brownfield is detected, proceed to the mapper step below.

**Mapper Spawning**
When existing source files are detected, tell the user conversationally: "I see you already have code here. Let me take a look at what you've built so far."

Then spawn the director-mapper agent using the Task tool. Pass it these instructions wrapped in XML boundary tags per reference/context-management.md:

```
<instructions>
Map this codebase completely. Report your findings using your standard output format:
- What you found (1-2 sentence summary)
- Built with (tech stack in plain language)
- What it can do (feature inventory as user capabilities)
- How it's organized (project structure overview)
- Things worth noting (observations about codebase health)
</instructions>
```

Wait for the mapper to complete (run it in foreground, not background -- the user needs the results before the interview can begin).

**Findings Presentation**
Once the mapper returns, present the findings to the user in plain language. Format it conversationally:

"Here's what I see in your project:"
[Present mapper findings organized under clear headings]

Then ask: "Does this look right? Anything I missed or got wrong?"

Wait for the user to confirm or correct the findings. Incorporate any corrections.

**Brownfield Interview**
After the user confirms the mapping, conduct a modified interview. The brownfield interview follows the same inline interview approach as greenfield but with these key adaptations (per agents/director-interviewer.md Brownfield Mode):

1. Acknowledge what already exists -- start from what the mapper found, not from scratch
2. Ask what they want to CHANGE, not what they want to BUILD -- the project exists, focus on what's next
3. Present findings as observations -- "Here's what I see" not "Here's what you have"
4. Skip already-answered questions:
   - Skip tech stack questions (unless user wants to change it) -- the mapper already identified it
   - Skip "what are you building?" -- the mapper already described it
   - Skip architecture questions -- the mapper already analyzed it
5. Focus on gaps -- identify what exists vs what the user wants, those gaps become the vision

Brownfield interview sections (adapted from the 8 greenfield sections):
1. What do you want to change or add? (the core question -- what's the delta?)
2. Who is this for? (skip if obvious from existing code)
3. New features needed (what capabilities should be added?)
4. Tech stack changes (only if the user wants to change something)
5. What does "done" look like for this round of work? (success criteria for the changes)
6. Decisions already made about the changes
7. Anything you're unsure about?

Target 5-10 questions for brownfield (shorter than greenfield since much is already known).

**Brownfield Vision Generation**
Generate VISION.md for brownfield projects following the same canonical template, but with brownfield-specific content:

- **Project Name:** From existing project (confirm with user)
- **What It Does:** From mapper findings + user's vision for changes
- **Who It's For:** From interview
- **Key Features:**
  - EXISTING: [features the mapper found that are staying]
  - ADDING: [new features from interview]
  - CHANGING: [modifications to existing features]
  - REMOVING: [features being removed, if any]
  This is the delta format (ADDED/MODIFIED/REMOVED per research Pattern 2).
- **Tech Stack:** From mapper + any changes from interview
- **Success Looks Like:** From interview (what "done" means for this round)
- **Decisions Made:** Include both existing decisions (from codebase) and new decisions
- **Open Questions:** With [UNCLEAR] markers

Present for user confirmation, iterate, then write to `.director/VISION.md` (same confirmation flow as greenfield).

**Already-Onboarded Path Enhancement**
Also update the already-onboarded path (when VISION.md has real content). Currently it offers "update or map code." Make both options functional:
- "Update your vision" -> run the interview again with existing vision content loaded, following interviewer rule 7 (adapt to what's already known, skip answered questions, focus on gaps)
- "Map your code" -> spawn mapper, present findings, then ask if they want to update the vision based on what was found

**Language requirements:**
- All the same plain-language rules as greenfield
- Present mapper findings as collaborative observations, not judgments
- Use delta language naturally: "You have X, and you want to add Y" not "ADDED: Y"
- The delta format in VISION.md uses section labels (EXISTING/ADDING/CHANGING/REMOVING) but the conversation itself is natural
  </action>
  <verify>
Read the completed skills/onboard/SKILL.md and verify:
1. Brownfield detection no longer contains "coming soon" placeholder
2. Mapper spawning uses Task tool with XML-tagged instructions
3. Mapper findings presentation is conversational with user confirmation
4. Brownfield interview sections are adapted (7 sections, not 8 -- skips already-known info)
5. Brownfield interview explicitly skips tech stack (unless user wants changes) and "what are you building?"
6. Brownfield vision generation includes delta format (EXISTING/ADDING/CHANGING/REMOVING under Key Features)
7. Already-onboarded path has functional "update vision" and "map code" options
8. All user-facing text follows Director plain-language conventions
9. File is at least 150 lines (both greenfield and brownfield workflows need substantial instruction)
10. $ARGUMENTS placeholder remains at end of file
11. Greenfield workflow from Plan 01 is preserved intact
  </verify>
  <done>
The onboard SKILL.md contains complete greenfield AND brownfield workflows. Brownfield path spawns the mapper agent, presents findings conversationally, conducts an adapted interview focused on changes (not builds), and generates VISION.md with delta format. The already-onboarded path offers functional update and map options. All user-facing text follows Director's plain-language conventions.
  </done>
</task>

</tasks>

<verification>
1. Read skills/onboard/SKILL.md end-to-end and confirm both greenfield and brownfield paths are complete
2. Verify mapper spawning instructions reference the correct agent name (director-mapper) and use XML boundary tags
3. Verify brownfield interview does NOT re-ask questions the mapper already answered
4. Verify delta format appears in the vision generation section (EXISTING/ADDING/CHANGING/REMOVING)
5. Verify no developer jargon in user-facing messages
6. Check that the already-onboarded path has two functional options (not just the offer to choose)
</verification>

<success_criteria>
- Brownfield onboarding is fully described: mapper spawning, findings presentation, adapted interview, delta-format vision
- The mapper agent is spawned correctly via Task tool with proper XML context
- The brownfield interview is distinct from greenfield: shorter, focused on changes, skips known info
- Delta format in VISION.md clearly separates existing features from additions/changes/removals
- Already-onboarded re-entry path is functional for both "update" and "map" options
- All ONBR requirements (01-11) are covered across plans 01 and 02
</success_criteria>

<output>
After completion, create `.planning/phases/02-onboarding/02-02-SUMMARY.md`
</output>
