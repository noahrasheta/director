---
phase: 03-planning
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - skills/blueprint/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Running /director:blueprint on a project with an existing gameplan enters update mode instead of creating a new one"
    - "Update mode re-evaluates the entire gameplan holistically, even when inline text provides a focused scope"
    - "Changes are communicated via delta summary (Added/Changed/Removed/Reordered) before writing files"
    - "Completed goals, steps, and tasks are frozen during updates -- never silently removed or modified"
    - "Running /director:blueprint 'add payment processing' acknowledges the inline text and uses it as the focus for re-evaluation"
    - "Same explicit approval flow as creation: show delta, ask for confirmation, wait for yes before saving"
  artifacts:
    - path: "skills/blueprint/SKILL.md"
      provides: "Update mode workflow added to existing blueprint skill"
      min_lines: 300
  key_links:
    - from: "skills/blueprint/SKILL.md"
      to: ".director/GAMEPLAN.md"
      via: "Read existing gameplan content to detect update mode"
      pattern: "GAMEPLAN\\.md"
    - from: "skills/blueprint/SKILL.md"
      to: ".director/goals/"
      via: "Read existing goal/step/task files during update"
      pattern: "goals/"
---

<objective>
Add update mode and inline context support to the blueprint skill. When a gameplan already exists, the skill performs holistic re-evaluation, presents changes as a delta summary, gets explicit approval, and writes updated files -- all while preserving completed work.

Purpose: Users evolve their gameplan as their project grows. Without update mode, they'd have to start over or manually edit structured files -- both unacceptable for vibe coders.

Output: Updated `skills/blueprint/SKILL.md` with full update mode workflow (PLAN-08, PLAN-09 requirements).
</objective>

<execution_context>
@/Users/noahrasheta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/noahrasheta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-planning/03-RESEARCH.md
@.planning/phases/03-planning/03-01-SUMMARY.md
@skills/blueprint/SKILL.md
@agents/director-planner.md
@skills/blueprint/templates/gameplan-template.md
@reference/terminology.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add update mode workflow to blueprint SKILL.md</name>
  <files>skills/blueprint/SKILL.md</files>
  <action>
Read the current `skills/blueprint/SKILL.md` (written by Plan 03-01) and add the update mode workflow. Replace the update mode placeholder with the full implementation.

**What to add/modify:**

1. **Update the "Determine Project State" section**: The detection logic from Plan 01 already distinguishes new vs update mode. Replace the update mode placeholder ("Updating an existing gameplan will be available in a future update") with a route to the new Update Mode section.

2. **Add "Update Mode" section** (new major section, placed after the Write Gameplan section and before Language Reminders). Structure it as follows:

   **a. Load Existing Gameplan:**
   - Read `.director/GAMEPLAN.md` for the overview
   - Read existing goals/ directory to understand current structure: scan for GOAL.md, STEP.md, and task files
   - Identify what is completed (items marked as done/complete in status sections) vs what is still pending
   - Store the current state mentally before re-evaluating

   **b. Handle $ARGUMENTS in Update Mode:**
   - If $ARGUMENTS is non-empty, acknowledge it as the focus: "You want to [arguments]. Let me see how that fits into your current gameplan."
   - Use the inline text as the primary context for what changed, but still re-evaluate holistically (locked decision)
   - If $ARGUMENTS is empty, ask the user what prompted the update: "What's changed? New features to add, something to reorganize, or just want to review the plan?"

   **c. Freeze Completed Work:**
   - Goals, steps, or tasks marked as complete are FROZEN -- never removed or modified
   - If new context would logically require changes to completed work, flag it for the user: "The login page was already built, but adding OAuth might need some changes to it. Want to add a task for that?"
   - This implements the planner agent's Update Mode Rule 1

   **d. Re-evaluate and Generate Updated Goals:**
   - Re-read VISION.md for current vision state
   - Compare existing goals against the vision + any new context from $ARGUMENTS
   - Generate an updated goal set (following the same Phase 1 goal review pattern from new gameplan mode)
   - Present updated goals together, highlighting what changed:
     ```
     Here's how I'd update your goals:

     1. **[Existing goal -- unchanged]** -- [Same description]
     2. **[Modified goal]** -- [Updated description] (was: [old description])
     3. **[New goal]** -- [Why this was added]

     [If any removed:] I'd suggest removing: [goal] because [reason].

     What do you think?
     ```
   - Wait for approval on goals before proceeding (same as new gameplan mode)

   **e. Generate Updated Hierarchy:**
   - After goal approval, generate the full updated Steps and Tasks
   - For completed items: keep them exactly as-is
   - For pending items: may be reordered, modified, or removed based on the re-evaluation
   - New items: added where they fit in the structure

   **f. Present Delta Summary:**
   - Before showing the full outline, present a delta summary using Added/Changed/Removed/Reordered format:
     ```
     Here's what I'd change:

     **Added:**
     - [New item with explanation]

     **Changed:**
     - [Modified item: was X, now Y, because Z]

     **Removed:**
     - [Removed item with reasoning]

     **Reordered:**
     - [Item moved: was in Step X, now in Step Y, because Z]

     **Already done (keeping as-is):**
     - [Completed items preserved]
     ```
   - Then show the full updated outline (same format as new gameplan mode)
   - Ask "Does this look good?" and wait for explicit approval

   **g. Write Updated Files:**
   - Rewrite `.director/GAMEPLAN.md` with updated overview
   - For modified goals/steps/tasks: overwrite the existing files
   - For new goals/steps/tasks: create new directories and files
   - For removed items: delete the files and directories (but NEVER delete completed items)
   - Preserve completed item files exactly as they are
   - Same conversational narration: "Your gameplan is updated. [Brief summary of what changed]."

   **h. Suggest Next Step:**
   - Same as new gameplan mode: "Ready to start building? You can do that with `/director:build`."

3. **Update the existing $ARGUMENTS handling** in the "Handle Arguments" section to differentiate between new and update mode:
   - New mode: "You want to focus on [arguments]. Let me read your vision and create a gameplan."
   - Update mode: "You want to [arguments]. Let me see how that fits into your current gameplan."

**Important implementation details:**
- The delta format (Added/Changed/Removed/Reordered) aligns with the brownfield onboarding pattern (Existing/Adding/Changing/Removing). Use this consistent pattern.
- Holistic re-evaluation means even focused inline text triggers a full review -- additions may affect ordering, dependencies, or grouping elsewhere (locked decision).
- Every removal must be explicitly stated with reasoning -- no silent deletions (planner agent Update Mode Rule 3).
- The "Already done" section in the delta summary reassures the user that completed work is safe.
- Dependencies must be re-evaluated after updates -- new work may change what's ready and what's blocked (planner agent Update Mode Rule 5).
- All user-facing language follows Director terminology (no jargon).
  </action>
  <verify>
Read the resulting `skills/blueprint/SKILL.md` and verify:
1. Update mode placeholder is replaced with full implementation
2. Existing gameplan detection routes to update mode (not placeholder)
3. $ARGUMENTS handling differentiates new vs update mode
4. Completed work freezing is explicitly instructed
5. Delta summary format includes Added/Changed/Removed/Reordered/Already done sections
6. Goal-level review happens in update mode (same two-phase flow as new mode)
7. Explicit approval required before writing updated files
8. File operations handle create, modify, and delete (but never delete completed items)
9. No developer jargon in user-facing messages
10. No "coming soon" or "future update" references remain for update mode
11. The skill still ends with $ARGUMENTS
12. New gameplan creation flow from Plan 01 is preserved (not broken by update mode additions)
  </verify>
  <done>
The blueprint skill handles both new gameplan creation AND update mode. Update mode reads existing gameplan, re-evaluates holistically, presents delta summary (Added/Changed/Removed/Reordered), preserves completed work, gets explicit approval, and writes updated files. Inline context via $ARGUMENTS is acknowledged and used as the focus for re-evaluation. All 9 PLAN requirements (PLAN-01 through PLAN-09) are covered.
  </done>
</task>

</tasks>

<verification>
- Read `skills/blueprint/SKILL.md` and confirm update mode is fully implemented (not a placeholder)
- Confirm the skill handles both new and update paths without breaking either
- Confirm delta summary format matches the brownfield onboarding pattern (Added/Changed/Removed)
- Confirm completed work is explicitly frozen (never silently removed)
- Confirm $ARGUMENTS works in both new and update modes
- Confirm holistic re-evaluation is instructed even when $ARGUMENTS provides focused scope
- Trace all 9 PLAN requirements to specific sections of the skill:
  - PLAN-01: Vision-to-Goals in Phase 1 section
  - PLAN-02: Goals-to-Steps in Phase 2 section
  - PLAN-03: Steps-to-Tasks in Phase 2 section
  - PLAN-04: Task fields (5 required) in Phase 2 section
  - PLAN-05: Ready-work filtering in Phase 2 presentation
  - PLAN-06: Gameplan presented for review (both modes)
  - PLAN-07: GAMEPLAN.md written in Write section
  - PLAN-08: Update mode in Update Mode section
  - PLAN-09: $ARGUMENTS handling in Handle Arguments section
</verification>

<success_criteria>
- Update mode is fully functional in the blueprint skill
- Delta summary uses Added/Changed/Removed/Reordered format
- Completed work is frozen during updates
- $ARGUMENTS works in both new and update modes
- No placeholder text remains ("coming soon", "future update")
- All 9 PLAN requirements (PLAN-01 through PLAN-09) are satisfied by the combined skill
- The skill file is coherent and well-structured (not a patchwork of additions)
</success_criteria>

<output>
After completion, create `.planning/phases/03-planning/03-02-SUMMARY.md`
</output>
