---
phase: 04-execution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - agents/director-builder.md
  - agents/director-syncer.md
autonomous: true

must_haves:
  truths:
    - "Builder agent can spawn researcher sub-agent within a task"
    - "Syncer agent renames task files to .done.md after completion"
    - "Syncer understands amend-commit pattern -- never creates its own commits"
  artifacts:
    - path: "agents/director-builder.md"
      provides: "Builder agent with researcher in tools list"
      contains: "Task(director-verifier, director-syncer, director-researcher)"
    - path: "agents/director-syncer.md"
      provides: "Syncer agent with .done.md rename and amend-commit awareness"
      contains: ".done.md"
  key_links:
    - from: "agents/director-builder.md"
      to: "agents/director-researcher.md"
      via: "Task tool spawning"
      pattern: "director-researcher"
    - from: "agents/director-syncer.md"
      to: ".director/goals/*/tasks/*.md"
      via: "file rename convention"
      pattern: "\\.done\\.md"
---

<objective>
Update builder and syncer agents to support the execution pipeline.

Purpose: The build skill (Plan 02) orchestrates execution by spawning these agents. The builder needs researcher access for within-task research. The syncer needs to handle task file renames (.done.md convention) and understand that its changes get amend-committed to the task's atomic commit rather than creating separate commits.

Output: Updated `agents/director-builder.md` and `agents/director-syncer.md` ready for the execution pipeline.
</objective>

<execution_context>
@/Users/noahrasheta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/noahrasheta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-execution/04-RESEARCH.md
@agents/director-builder.md
@agents/director-syncer.md
@agents/director-researcher.md
@reference/context-management.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update builder agent for execution pipeline</name>
  <files>agents/director-builder.md</files>
  <action>
Update `agents/director-builder.md` with these changes:

1. **Tools line:** Change the tools frontmatter from:
   `tools: Read, Write, Edit, Bash, Grep, Glob, Task(director-verifier, director-syncer)`
   to:
   `tools: Read, Write, Edit, Bash, Grep, Glob, Task(director-verifier, director-syncer, director-researcher)`

2. **Sub-Agents section:** Add `director-researcher` as a named sub-agent the builder can spawn. Add it after the existing director-syncer entry in the Sub-Agents section:
   ```
   - **director-researcher:** Investigates libraries, APIs, and implementation approaches when you encounter a decision point. Spawn this when you need to choose between options or understand how something works before implementing. Pass it the specific question and any constraints from the task.
   ```

3. **Execution Rules -- rule 6 update:** The current rule 6 says "Run verification after committing." Update it to clarify that the builder creates a commit, then spawns verifier, and if issues are found, fixes them and amends the commit. The commit should happen BEFORE verification, and fixes amend it. This matches the research recommendation.

4. **Git Rules update:** The current rule says "Never force push, amend previous commits, or rewrite history." This needs a carve-out: the builder MAY amend its own commit within the same task session if verification finds issues that need fixing. Update to: "Never force push or rewrite history. You may amend your own task commit if verification finds issues that need fixing -- use `git add -A && git commit --amend --no-edit` after each fix."

Keep all other content unchanged. The builder's system prompt, context expectations, output format, and language rules are already correct for the execution pipeline.
  </action>
  <verify>
Read `agents/director-builder.md` and confirm:
- `director-researcher` appears in the tools frontmatter
- Sub-Agents section lists all three: verifier, syncer, researcher
- Git Rules allow amending own commit during verification fixes
  </verify>
  <done>Builder agent has researcher in tools, researcher documented in Sub-Agents, and git rules allow self-amendment during verification</done>
</task>

<task type="auto">
  <name>Task 2: Update syncer agent for task completion and amend-commit pattern</name>
  <files>agents/director-syncer.md</files>
  <action>
Update `agents/director-syncer.md` with these changes:

1. **Add task file rename to Sync Process:** After step 2 (Check STATE.md), add a new step "Rename completed task file":
   ```
   ### 3. Rename completed task file

   Rename the task file from `NN-task-slug.md` to `NN-task-slug.done.md` in the same directory. This marks the task as complete in the file system and prevents it from being picked up again as a ready task.

   Use Bash to rename: `mv "$TASK_PATH" "${TASK_PATH%.md}.done.md"`
   ```
   Renumber the existing steps 3 and 4 to 4 and 5.

2. **Add `<changes>` to Context You Receive:** Add a new context tag the syncer should expect:
   ```
   - `<changes>` -- The git diff summary showing what files were actually changed. Use this to verify the task's changes match expectations.
   ```

3. **Update the Important Rules section:** Add a rule about the amend-commit pattern:
   ```
   5. **Your changes get amend-committed.** After you finish, the build skill will stage your changes and amend the task's git commit. This keeps everything in one atomic commit per task. You do NOT need to run any git commands yourself -- just make your file changes and report your findings.
   ```

4. **Update the scope table:** Add a row for task files:
   ```
   | `.director/goals/*/tasks/*.md` | Rename only | Rename to `.done.md` to mark task complete |
   ```

Keep all other content unchanged. The syncer's scope rules, output format, and general approach are already correct.
  </action>
  <verify>
Read `agents/director-syncer.md` and confirm:
- Sync Process includes task file rename step with `.done.md` convention
- Context section includes `<changes>` tag
- Important Rules mentions amend-commit pattern
- Scope table includes task file rename row
  </verify>
  <done>Syncer agent handles .done.md renames, expects change context, and understands amend-commit pattern</done>
</task>

</tasks>

<verification>
- Both agent files parse correctly (valid YAML frontmatter, coherent Markdown)
- Builder tools include all three sub-agents: verifier, syncer, researcher
- Syncer has .done.md rename step in its process
- No contradictions between builder and syncer instructions (builder creates commit, syncer modifies docs, build skill amends)
</verification>

<success_criteria>
- Builder agent can spawn researcher, verifier, and syncer sub-agents
- Syncer agent knows to rename task files to .done.md
- Syncer understands its changes will be amend-committed (does not run git commands itself)
- Both agents' instructions are consistent with the execution pipeline described in 04-RESEARCH.md
</success_criteria>

<output>
After completion, create `.planning/phases/04-execution/04-01-SUMMARY.md`
</output>
