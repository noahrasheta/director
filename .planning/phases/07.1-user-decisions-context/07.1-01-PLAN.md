---
phase: 07.1-user-decisions-context
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/blueprint/templates/step-template.md
  - agents/director-builder.md
  - reference/context-management.md
autonomous: true

must_haves:
  truths:
    - "STEP.md template includes a Decisions section with Locked, Flexible, and Deferred categories"
    - "Builder agent knows how to interpret the <decisions> XML tag"
    - "Context management reference documents the <decisions> tag alongside existing tags"
  artifacts:
    - path: "skills/blueprint/templates/step-template.md"
      provides: "STEP.md template with Decisions section"
      contains: "## Decisions"
    - path: "agents/director-builder.md"
      provides: "Builder agent with decision awareness"
      contains: "<decisions>"
    - path: "reference/context-management.md"
      provides: "Context reference with decisions tag documented"
      contains: "<decisions>"
  key_links:
    - from: "skills/blueprint/templates/step-template.md"
      to: "agents/director-builder.md"
      via: "Decisions section format matches what builder expects"
      pattern: "Locked|Flexible|Deferred"
    - from: "reference/context-management.md"
      to: "agents/director-builder.md"
      via: "Both document the <decisions> tag consistently"
      pattern: "decisions"
---

<objective>
Add the Decisions section to the STEP.md template and update the builder agent and context management reference to understand the new `<decisions>` XML tag.

Purpose: This plan establishes the schema (STEP.md template) and consumer awareness (builder agent + reference doc) for user decisions. Plans 02 and 03 depend on these artifacts being in place before they wire up the producer (blueprint) and pipeline (build skill).

Output: Updated STEP.md template with Decisions section, builder agent with decision rules, context reference with `<decisions>` tag documented.
</objective>

<execution_context>
@/Users/noahrasheta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/noahrasheta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.1-user-decisions-context/07.1-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Decisions section to STEP.md template</name>
  <files>skills/blueprint/templates/step-template.md</files>
  <action>
Read the current step-template.md (19 lines). Append a `## Decisions` section AFTER the existing `## Needs First` section (Decisions goes LAST in the template, per research).

The Decisions section has three subsections:

```markdown
## Decisions

### Locked
_Choices the user explicitly made -- follow these exactly._

### Flexible
_Areas where the builder can use its best judgment._

### Deferred
_Ideas mentioned but explicitly set aside -- do not implement._
```

Use italicized instructional text as placeholders (matching the existing template style which uses `_italic prompts_` for guidance). Do NOT add example bullet points -- the categories should be empty by default. When the blueprint skill populates a STEP.md, it will fill in only the categories that have content, and omit the entire Decisions section if no decisions were captured (this behavior is defined in Plan 03).

The final template should be approximately 35 lines: the existing 19 lines plus the Decisions section.
  </action>
  <verify>Read `skills/blueprint/templates/step-template.md` and confirm: (1) `## Decisions` heading exists after `## Needs First`, (2) three subsections `### Locked`, `### Flexible`, `### Deferred` exist, (3) no content beyond italic instructional text in each subsection, (4) existing sections (What This Delivers, Tasks, Needs First) are unchanged.</verify>
  <done>STEP.md template has a Decisions section with three categories. Existing template content is preserved exactly. The section is last in the file.</done>
</task>

<task type="auto">
  <name>Task 2: Update builder agent and context reference for decisions awareness</name>
  <files>agents/director-builder.md, reference/context-management.md</files>
  <action>
**Builder agent (`agents/director-builder.md`):**

1. In the "Context You Receive" section (after the `<instructions>` bullet), add a new bullet for the `<decisions>` tag:

```markdown
- `<decisions>` -- User decisions for this step. Locked items are non-negotiable. Flexible items are your choice. Deferred items are out of scope -- do not implement them. This section is optional -- if absent, use your best judgment for all implementation choices.
```

2. In the "Execution Rules" section, add rule 9 after the existing rule 8 ("Check acceptance criteria before committing"):

```markdown
9. **Honor user decisions.** If `<decisions>` is present in your context:
   - **Locked:** Follow these exactly. If a locked decision says "use Tailwind", use Tailwind even if you would prefer a different approach.
   - **Flexible:** Use your best judgment. The user trusts your expertise here.
   - **Deferred:** Do NOT implement these, even partially. They are explicitly out of scope for this step, even if they seem related to your task.
   If no `<decisions>` section is present, use your best judgment for all implementation choices.
```

**Context management reference (`reference/context-management.md`):**

1. In the "Standard Tags" table, add a row for `<decisions>` between `<current_step>` and `<task>`:

```
| `<decisions>` | User decisions from STEP.md Decisions section | During build, if STEP.md has a Decisions section |
```

2. In the "Assembly Example" XML block, add a `<decisions>` section between `<current_step>` and `<task>`:

```xml
<decisions>
These are the user's decisions for this step. Follow them exactly:

### Locked
- Use Supabase for the database
- Keep the API RESTful, no GraphQL

### Flexible
- Styling approach -- user has no preference

### Deferred
- Dark mode support -- saving for later

RULES:
- Locked items are non-negotiable -- follow them exactly as stated.
- Flexible items are your choice -- use your best judgment.
- Deferred items are out of scope -- do NOT implement them, even partially.
</decisions>
```

3. In the "Agent-Specific Context Profiles" table, add a "Decisions" column. Set "Yes" for Builder only. All other agents get "No". (Decisions are only relevant during build execution.)

4. In the "Truncation Strategy" section, add after rule 4 ("Never truncate task or vision"):

```
5. **Never truncate decisions** -- User decisions are essential for correct execution. The `<decisions>` section is small (typically under 100 tokens) and must always be included in full.
```
  </action>
  <verify>
(1) Read `agents/director-builder.md`: confirm `<decisions>` bullet in "Context You Receive" section, rule 9 in "Execution Rules" section, mentions Locked/Flexible/Deferred.
(2) Read `reference/context-management.md`: confirm `<decisions>` row in Standard Tags table, `<decisions>` section in Assembly Example, Decisions column in Agent-Specific Context Profiles table, truncation rule 5 about never truncating decisions.
  </verify>
  <done>Builder agent has decision awareness rules. Context management reference documents the `<decisions>` tag in the table, example, agent profiles, and truncation strategy.</done>
</task>

</tasks>

<verification>
- STEP.md template has Decisions section with Locked/Flexible/Deferred subsections
- Builder agent documents `<decisions>` tag in context section and has honor-decisions rule
- Context management reference has `<decisions>` in tag table, assembly example, agent profiles, and truncation rules
- All existing content in modified files is preserved (no regressions)
</verification>

<success_criteria>
The schema for user decisions (STEP.md template) and consumer awareness (builder agent + reference doc) are in place. The builder agent knows what to do when it receives `<decisions>` context, and the reference documentation is consistent with the new tag.
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-user-decisions-context/07.1-01-SUMMARY.md`
</output>
