---
phase: 07.1-user-decisions-context
plan: 02
type: execute
wave: 2
depends_on: ["07.1-01"]
files_modified:
  - skills/build/SKILL.md
autonomous: true

must_haves:
  truths:
    - "The build skill extracts decisions from STEP.md and wraps them in a <decisions> XML tag for the builder"
    - "If STEP.md has no Decisions section, the build skill skips <decisions> entirely with no errors"
    - "The <decisions> tag is positioned between <current_step> and <task> in the assembled context"
    - "The decisions section is never truncated by the context budget calculator"
  artifacts:
    - path: "skills/build/SKILL.md"
      provides: "Build skill with decisions loading in context assembly"
      contains: "<decisions>"
  key_links:
    - from: "skills/build/SKILL.md"
      to: "agents/director-builder.md"
      via: "Assembled <decisions> tag matches what builder expects"
      pattern: "decisions"
    - from: "skills/build/SKILL.md"
      to: "skills/blueprint/templates/step-template.md"
      via: "Extracts ## Decisions heading from STEP.md content"
      pattern: "Decisions"
---

<objective>
Update the build skill's context assembly pipeline to extract the Decisions section from STEP.md, wrap it in `<decisions>` XML tags, and include it in the builder's assembled context.

Purpose: This is the pipeline that connects the decisions captured by the blueprint skill (Plan 03) to the builder agent that consumes them. Without this, decisions written into STEP.md would never reach the builder's fresh context window.

Output: Updated build skill (SKILL.md) with decisions loading between steps 5b and 5c, backward-compatible skip logic, and truncation protection.
</objective>

<execution_context>
@/Users/noahrasheta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/noahrasheta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.1-user-decisions-context/07.1-RESEARCH.md
@.planning/phases/07.1-user-decisions-context/07.1-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add decisions extraction to build skill context assembly</name>
  <files>skills/build/SKILL.md</files>
  <action>
Read the current `skills/build/SKILL.md` (494 lines). The context assembly happens in Step 5, with subsections 5a (Vision), 5b (Current step), 5c (Task), 5d (Recent changes), 5e (Instructions), 5f (Context budget).

Add a new subsection `### 5b-2: Decisions` between the existing `### 5b: Current step` and `### 5c: Task`. This section handles extracting and wrapping user decisions from the STEP.md content already read in step 5b.

The new subsection content:

```markdown
### 5b-2: Decisions

Check the STEP.md content (already read in Step 5b) for a `## Decisions` heading.

**If a `## Decisions` heading exists:**

Extract everything from `## Decisions` through the end of the STEP.md content. Wrap it in a `<decisions>` tag:

\```
<decisions>
These are the user's decisions for this step. Follow them exactly:

[Extracted Decisions content from STEP.md -- includes Locked, Flexible, and Deferred subsections]

RULES:
- Locked items are non-negotiable -- follow them exactly as stated.
- Flexible items are your choice -- use your best judgment.
- Deferred items are out of scope -- do NOT implement them, even partially.
</decisions>
\```

Position the `<decisions>` section between `<current_step>` and `<task>` in the assembled context. This ordering follows the context assembly tag rule: vision first, then scoping (step, decisions, task), then context (changes), then instructions last.

**If no `## Decisions` heading exists in the STEP.md content:**

Skip this section entirely. Do NOT include an empty `<decisions>` tag or any placeholder. The builder operates with full AI discretion when no decisions are present. This ensures backward compatibility with STEP.md files from Phases 1-7 that have no Decisions section.
```

Additionally, update Step 5e (Instructions) to add one line inside the `<instructions>` template, after the "Follow reference/terminology.md" line:

```
Honor all Locked decisions exactly. Use your judgment on Flexible items. Do NOT implement anything listed as Deferred.
```

Additionally, update Step 5f (Context budget calculation) to update the truncation order. The current truncation rules are numbered 1-4. After rule 4 ("Never truncate the task file or VISION.md"), add:

```
5. **Never truncate the `<decisions>` section.** User decisions are essential for correct task execution and are typically under 100 tokens.
```

And update the context budget estimation note to include decisions in the list of sections being counted: "Use character count divided by 4 as the approximation" should reference that the total includes vision + step + decisions + task + git log + instructions. Also update the cost_data instructions in Step 5e to include decisions in the character count: `context_chars: the total character count of the assembled context from Step 5 (vision + step + decisions + task + git log + instructions)`.
  </action>
  <verify>
Read `skills/build/SKILL.md` and confirm:
(1) A `### 5b-2: Decisions` subsection exists between 5b and 5c.
(2) The subsection checks for `## Decisions` heading in STEP.md content.
(3) If found, extracts and wraps in `<decisions>` tags with preamble and RULES footer.
(4) If not found, explicitly skips with no empty tags.
(5) The `<instructions>` template in Step 5e includes the "Honor all Locked decisions" line.
(6) Truncation rule 5 about never truncating decisions exists in Step 5f.
(7) The context budget character count includes "decisions" in the list of sections.
(8) All existing build skill content (Steps 1-4, 6-10) is unchanged.
  </verify>
  <done>Build skill extracts decisions from STEP.md, wraps in XML tags, positions correctly in context assembly, skips gracefully when absent, and protects decisions from truncation.</done>
</task>

</tasks>

<verification>
- Build skill has a decisions extraction step (5b-2) in the context assembly pipeline
- Backward compatibility: absent Decisions section causes clean skip with no errors or empty tags
- `<decisions>` tag positioned between `<current_step>` and `<task>` in assembly order
- Instructions template reinforces decision-honoring rules
- Decisions protected from truncation in context budget section
- All existing build skill steps (1-10) remain functionally unchanged
</verification>

<success_criteria>
The build skill pipeline loads decisions from STEP.md into the builder's assembled context. When STEP.md has a Decisions section, the builder receives it wrapped in `<decisions>` tags with clear rules. When STEP.md has no Decisions section (all pre-7.1 content), nothing changes in the builder's context.
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-user-decisions-context/07.1-02-SUMMARY.md`
</output>
