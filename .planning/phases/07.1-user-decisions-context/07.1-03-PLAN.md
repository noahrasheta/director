---
phase: 07.1-user-decisions-context
plan: 03
type: execute
wave: 2
depends_on: ["07.1-01"]
files_modified:
  - skills/blueprint/SKILL.md
  - agents/director-planner.md
autonomous: true

must_haves:
  truths:
    - "Blueprint skill captures user decisions from the conversation and writes them into STEP.md Decisions sections"
    - "Decision capture is passive -- extracted from natural conversation, not an interrogation step"
    - "Cross-cutting decisions are propagated to all relevant steps"
    - "Steps with no relevant decisions omit the Decisions section entirely"
    - "Blueprint update mode reviews and updates existing decisions in modified steps while freezing completed-step decisions"
  artifacts:
    - path: "skills/blueprint/SKILL.md"
      provides: "Blueprint skill with decision capture during hierarchy generation"
      contains: "Decisions"
    - path: "agents/director-planner.md"
      provides: "Planner agent with awareness of Decisions section"
      contains: "Decisions"
  key_links:
    - from: "skills/blueprint/SKILL.md"
      to: "skills/blueprint/templates/step-template.md"
      via: "Blueprint writes Decisions section into STEP.md files using template structure"
      pattern: "Locked|Flexible|Deferred"
    - from: "skills/blueprint/SKILL.md"
      to: "skills/build/SKILL.md"
      via: "Decisions written by blueprint are later extracted by build skill"
      pattern: "Decisions"
---

<objective>
Update the blueprint skill to capture user decisions from the planning conversation and write them into the Decisions section of each STEP.md file. Update the planner agent to be aware of the Decisions section.

Purpose: This is the producer side of the decisions pipeline. The blueprint conversation is where users express preferences about technology, design, and scope. Without capturing these decisions at blueprint time, they would be lost by the time the builder spawns in a fresh context window.

Output: Updated blueprint skill with passive decision extraction and STEP.md population. Updated planner agent with Decisions section awareness.
</objective>

<execution_context>
@/Users/noahrasheta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/noahrasheta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.1-user-decisions-context/07.1-RESEARCH.md
@.planning/phases/07.1-user-decisions-context/07.1-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add decision capture to blueprint skill</name>
  <files>skills/blueprint/SKILL.md</files>
  <action>
Read the current `skills/blueprint/SKILL.md` (549 lines). The blueprint skill has two main flows: new gameplan mode and update mode. Decision capture needs to be added to both.

**Add a new section "Capture Step-Level Decisions" between the existing "Phase 2: Generate Full Hierarchy" section and the "Write Gameplan" section.** This section runs after the user approves the full hierarchy outline and before files are written:

```markdown
## Capture Step-Level Decisions

After the user approves the full hierarchy outline and before writing files, extract decisions from the conversation.

### What counts as a decision

A decision is a statement the user made about HOW something should be built. Look for:

- **Technology choices:** "use Supabase", "stick with REST", "use Tailwind"
- **Design direction:** "keep the UI simple", "no animations", "single-page layout"
- **Implementation approach:** "server-side rendering", "use existing auth library"
- **Scope boundaries:** "skip dark mode for now", "don't worry about mobile yet"

What is NOT a decision (these belong in vision or task descriptions):
- General project descriptions ("it's a task management app")
- Feature requests ("I want users to be able to share lists")
- Goal definitions ("users can manage their accounts")

### How to capture decisions

1. Review the entire conversation (both Phase 1 goal discussion and Phase 2 hierarchy discussion) for statements matching the categories above.

2. For each decision found, determine which step it most affects. If a decision is cross-cutting (e.g., "use PostgreSQL for everything"), assign it to EVERY step where it is relevant. Duplicate the decision into each affected step rather than creating an inheritance mechanism.

3. Categorize each decision:
   - **Locked:** User said "use X" or "I want Y" or "make sure Z" -- an explicit directive about how to build something.
   - **Flexible:** User said "I don't care about X" or "whatever works" or simply did not express a preference on a choice point that the planner surfaced. Include brief context when available (e.g., "Styling approach -- user has no preference").
   - **Deferred:** User said "not now" or "save for later" or "skip X for now" -- explicit scope boundary.

4. Associate each decision with the step(s) it affects.

### Important rules

- Do NOT ask the user to enumerate their decisions. Extract them passively from the natural conversation. This should be invisible to the user -- they see their gameplan written, and the decisions they expressed are captured without any additional interaction.
- Do NOT create Flexible items for every conceivable choice. Only include Flexible items where the conversation specifically surfaced a choice point and the user expressed no preference. Silence on a topic is not a Flexible decision -- it just means the builder has normal discretion.
- If a step has no relevant decisions from the conversation, OMIT the Decisions section entirely from that step's STEP.md. Do not write empty categories.
```

**Update the "Write Gameplan" section's STEP.md file-writing instructions.** In the current "Step directories and files" subsection, the STEP.md template shows four sections (heading, What This Delivers, Tasks, Needs First). Update this template example to include the optional Decisions section:

```markdown
  ```markdown
  # Step N: [Step Name]

  ## What This Delivers

  [What will be working or available when this step is done?]

  ## Tasks

  - [ ] Task 1: [Task Name]
  - [ ] Task 2: [Task Name]

  ## Needs First

  [What needs to be done before this step can start? Plain language.]
  [If nothing: "Nothing -- this step can start right away."]

  ## Decisions

  ### Locked
  - [Decision from conversation]

  ### Flexible
  - [Area where builder can choose -- with context]

  ### Deferred
  - [Item explicitly set aside]
  ```

  **Note:** Only include the Decisions section if the "Capture Step-Level Decisions" step identified relevant decisions for this step. Omit the entire section (including the ## Decisions heading) if there are no decisions. Only include categories (Locked, Flexible, Deferred) that have items -- omit empty categories.
```

**Update the Update Mode section.** In the "Write Updated Files" subsection, add decision handling for update mode:

```markdown
### Update Decisions in Modified Steps

When running in update mode:

1. **Completed steps:** Their Decisions sections are FROZEN. Do not modify, add, or remove decisions in completed steps, just as completed steps' tasks and content are frozen.

2. **Modified/pending steps:** Review the update conversation for new decisions. Merge new decisions with any existing decisions in the step's current STEP.md:
   - Add new Locked/Flexible/Deferred items from the update conversation.
   - If the user contradicted a previous decision (e.g., was "use SQLite", now says "switch to PostgreSQL"), update the Locked decision to reflect the new choice.
   - If the user deferred something that was previously Locked, move it to Deferred.

3. **New steps:** Capture decisions from the update conversation the same way as new gameplan mode.

Apply the same passive extraction approach -- do NOT ask the user to enumerate decisions for the update. Extract from the natural conversation.
```
  </action>
  <verify>
Read `skills/blueprint/SKILL.md` and confirm:
(1) A "Capture Step-Level Decisions" section exists between Phase 2 and Write Gameplan.
(2) The section defines what counts as a decision (tech choices, design, approach, scope boundaries).
(3) The section defines three categories (Locked, Flexible, Deferred) with clear criteria.
(4) Cross-cutting decision propagation is specified.
(5) Passive extraction is emphasized -- no interrogation step.
(6) The STEP.md template in Write Gameplan includes the optional Decisions section.
(7) Update mode has decision handling for frozen/modified/new steps.
(8) All existing blueprint skill content is preserved (routing, Phase 1, Phase 2, Write Gameplan structure, Language Reminders).
  </verify>
  <done>Blueprint skill captures decisions passively from the conversation, categorizes them as Locked/Flexible/Deferred, writes them into relevant STEP.md files, and handles update mode correctly.</done>
</task>

<task type="auto">
  <name>Task 2: Update planner agent with Decisions awareness</name>
  <files>agents/director-planner.md</files>
  <action>
Read the current `agents/director-planner.md` (147 lines). The planner agent is spawned by the blueprint skill to help structure the gameplan. It needs to know about the Decisions section so it can factor it into its planning.

Add a brief section after the existing "Update Mode" section and before "Output":

```markdown
## Decisions Awareness

When generating steps, be aware that each STEP.md may include a Decisions section with user preferences. You do not write the Decisions section -- that is handled by the blueprint skill after you return your structured plan. However:

- If the conversation includes explicit user preferences about technology, design, or scope, note them alongside the relevant steps in your output so the blueprint skill can capture them accurately.
- When evaluating task ordering and dependencies, consider that Locked decisions may constrain implementation choices (e.g., "use Supabase" means database tasks should assume Supabase).
- When sizing tasks, factor in that some choices are pre-made (Locked) while others are open (Flexible), which may affect complexity estimates.
```

This is a lightweight addition -- the planner does not write Decisions sections, but it should be aware they exist so its output is consistent with user-expressed preferences.
  </action>
  <verify>Read `agents/director-planner.md` and confirm: (1) a "Decisions Awareness" section exists, (2) it notes the planner does not write decisions but should be aware of them, (3) all existing planner agent content is preserved.</verify>
  <done>Planner agent is aware of the Decisions section and factors user preferences into its planning output.</done>
</task>

</tasks>

<verification>
- Blueprint skill has a decision capture section with clear criteria for what counts as a decision
- Decision capture is passive (extracted from conversation, no interrogation)
- Cross-cutting decisions propagated to all relevant steps
- Empty steps omit Decisions section entirely
- Update mode freezes completed-step decisions, merges new decisions into modified steps
- STEP.md template example in Write Gameplan shows optional Decisions section
- Planner agent is aware of Decisions section
- All existing content in both files preserved
</verification>

<success_criteria>
The blueprint skill captures user decisions from the planning conversation and writes them into STEP.md files. The planner agent factors decisions into its output. Update mode handles decisions correctly (freeze completed, merge modified, capture new). Steps with no decisions have no Decisions section. The user never sees an extra "what are your decisions?" step -- extraction is invisible.
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-user-decisions-context/07.1-03-SUMMARY.md`
</output>
