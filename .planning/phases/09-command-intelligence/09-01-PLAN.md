---
phase: 09-command-intelligence
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/undo/SKILL.md
  - skills/help/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Running /director:undo reverts the last task's commit, shown as 'Going back to before that task'"
    - "Undo confirms before reverting and warns on non-Director commits"
    - "Sequential undos work -- each invocation independently removes the most recent commit"
    - "/director:help shows all 12 commands including undo and ideas, with accurate descriptions and examples"
    - "/director:help build shows topic-specific help for the build command"
  artifacts:
    - path: "skills/undo/SKILL.md"
      provides: "Undo skill with git reset --hard HEAD~1 rollback"
      contains: "git reset --hard HEAD~1"
    - path: "skills/help/SKILL.md"
      provides: "Updated help with all commands and topic-specific mode"
      contains: "director:undo"
  key_links:
    - from: "skills/undo/SKILL.md"
      to: ".director/undo.log"
      via: "append-only log entry after each undo"
      pattern: "undo\\.log"
    - from: "skills/help/SKILL.md"
      to: "$ARGUMENTS"
      via: "topic-specific help when argument matches command name"
      pattern: "ARGUMENTS"
---

<objective>
Create the undo skill and update the help skill to reflect all 12 commands.

Purpose: Undo is the only genuinely new skill in Phase 9 -- it gives users a safety net for reverting task commits. Help needs updating to include undo, the ideas command, and to support topic-specific help mode.

Output: Two skill files -- one new (undo), one updated (help).
</objective>

<execution_context>
@/Users/noahrasheta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/noahrasheta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-command-intelligence/09-CONTEXT.md
@.planning/phases/09-command-intelligence/09-RESEARCH.md
@skills/help/SKILL.md
@reference/terminology.md
@reference/plain-language-guide.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create undo skill</name>
  <files>skills/undo/SKILL.md</files>
  <action>
Create a new skill file at skills/undo/SKILL.md with YAML frontmatter:
- name: undo
- description: "Go back to before the last task. Reverts the most recent change Director made."
- disable-model-invocation: true

The undo skill follows a 7-step flow. Reference the research document's code example for the exact flow, but here is the authoritative specification:

**Step 1: Check for a project.** If .director/ does not exist, say "Nothing to undo -- no project set up yet." and stop.

**Step 2: Check for commits to undo.** Run `git log --oneline -1 2>/dev/null`. If no commits exist, say "Nothing to undo -- no progress has been saved yet." and stop.

**Step 3: Identify the commit.** Parse the most recent commit message. Determine if it was made by Director:
- Director task commits: plain-language descriptions (from build skill -- e.g., "Build the login page with form validation")
- Quick task commits: start with `[quick]` prefix (e.g., "[quick] Change button color to blue")
- Undo log commits: start with "Log undo:" -- these are undo bookkeeping, treat as non-Director
- Non-Director commits: everything else (conventional commits like "fix:", "feat:", WIP, etc.)

If the commit does NOT look like a Director commit, warn: "The last saved change wasn't made by Director -- it looks like something you did manually. Still want to undo it?" Wait for confirmation. If they decline, stop.

**Step 4: Confirm with the user.** Extract a plain-language description from the commit message. Present: "Going back to before [task description from commit message]. This will remove those changes. Continue?" Wait for user response. If they decline, stop.

**Step 5: Execute undo.** Before resetting, capture the commit hash and message for the undo log:
```bash
COMMIT_HASH=$(git log --oneline -1 --format='%h')
COMMIT_MSG=$(git log --oneline -1 --format='%s')
```
Then execute: `git reset --hard HEAD~1`

IMPORTANT: Because Director's build skill amend-commits .director/ changes (STATE.md, .done.md renames) into the task commit, git reset --hard HEAD~1 automatically rolls back ALL state changes. No separate .director/ state restoration needed. The atomic commit principle means undo is also atomic.

**Step 6: Update undo log.** Append to .director/undo.log:
```
[YYYY-MM-DD HH:MM] Undid: [commit message] ([short hash])
```
Then commit the log update:
```bash
git add .director/undo.log
git commit -m "Log undo: [commit message]"
```

**Step 7: Confirm to user.** Say: "Done -- went back to before [task description]. Your project is back to where it was." Do NOT suggest next steps. The user knows what they want to do.

**Post-undo safety check:** After the reset, run `git status --porcelain` to verify no unexpected .director/ changes remain. If orphaned .done.md files exist for the supposedly undone task, rename them back to .md. This handles the edge case where the amend-commit in Step 9a of the build skill failed silently.

**Language Reminders section** at the end (same pattern as all other skills):
- Use Director vocabulary: "going back" not "reverting" or "rolling back"
- Never mention git, commits, hashes, or diffs to the user
- Say "saved change" not "commit"
- Say "going back to before" not "resetting HEAD"
- Be calm and reassuring -- undo is a safe operation
- Reference terminology.md and plain-language-guide.md

Include `$ARGUMENTS` at the very end of the file (consistent with all other skills). For undo, $ARGUMENTS is unused but present for consistency.
  </action>
  <verify>
Verify the file exists and has correct structure:
- File exists at skills/undo/SKILL.md
- Has YAML frontmatter with name, description, disable-model-invocation
- Contains all 7 steps
- Contains "git reset --hard HEAD~1"
- Contains undo.log append logic
- Contains post-undo safety check
- Contains Language Reminders section
- Contains $ARGUMENTS at end
- Does NOT use jargon words (revert, rollback, HEAD, commit) in user-facing message templates
  </verify>
  <done>
skills/undo/SKILL.md exists with complete 7-step undo flow using git reset --hard HEAD~1, user confirmation before action, undo log at .director/undo.log, non-Director commit detection with warning, and post-undo safety check. All user-facing messages use plain language per terminology.md.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update help skill with all commands and topic-specific mode</name>
  <files>skills/help/SKILL.md</files>
  <action>
Rewrite skills/help/SKILL.md to include all 12 commands and add topic-specific help mode. Keep the existing YAML frontmatter (name: help, description stays the same). Keep `disable-model-invocation` absent (help does not have it currently -- it uses model invocation for dynamic mini-status).

The updated help skill should:

1. **Keep the dynamic STATE.md injection** (`!cat .director/STATE.md 2>/dev/null || echo "NO_PROJECT"`) and the mini-status header logic (project name, current goal/step/task when available).

2. **Add topic-specific mode via $ARGUMENTS.** Replace the current "acknowledge arguments but show full list" behavior with:
   - If $ARGUMENTS matches a command name (build, onboard, blueprint, inspect, quick, idea, ideas, brainstorm, pivot, status, resume, undo, help), show that command's detailed help: description, what it does, common usage patterns, and 2-3 examples.
   - If $ARGUMENTS does not match a command name, show the full command list (default behavior).
   - If $ARGUMENTS is empty, show the full command list.

3. **Update the command table to include ALL 12 commands.** The current help is missing `undo` and `ideas` (plural). Organize into four groups matching Director's core loop:

   **Blueprint (Plan Your Project):**
   - /director:onboard -- Set up a new project or map an existing one
   - /director:blueprint -- Create, view, or update your gameplan

   **Build (Make Progress):**
   - /director:build -- Work on the next ready task
   - /director:quick "..." -- Fast change without full planning
   - /director:undo -- Go back to before the last task

   **Inspect (Check Your Work):**
   - /director:inspect -- Verify what was built matches the goal

   **Other:**
   - /director:status -- See your progress
   - /director:resume -- Pick up where you left off
   - /director:brainstorm -- Think out loud with full project context
   - /director:pivot -- Handle a change in direction
   - /director:idea "..." -- Capture an idea for later
   - /director:ideas -- Review your saved ideas
   - /director:help -- Show this guide (or help for a specific command)

4. **Topic-specific help content.** For each command, define a help block that includes:
   - One-line description
   - What it does (2-3 sentences)
   - Examples (2-3 usage examples with the /director: prefix)
   - Tips (1-2 practical tips)

   When rendering topic-specific help, show:
   > **`/director:[command]`** -- [description]
   >
   > [What it does paragraph]
   >
   > **Examples:**
   > - `/director:[command]` -- [what this does]
   > - `/director:[command] "..."` -- [what this does with args]
   >
   > **Tip:** [practical tip]

5. **Keep the "New here?" footer** for NO_PROJECT state.

6. **Update the welcome message** for NO_PROJECT to: "Welcome to Director! Here's what you can do:" (unchanged).

Do NOT use developer jargon in any help text. Descriptions must match what the user experiences, not implementation details.
  </action>
  <verify>
Verify the updated help file:
- File contains all 12 command names (onboard, blueprint, build, quick, undo, inspect, status, resume, brainstorm, pivot, idea, ideas, help)
- Contains topic-specific help logic checking $ARGUMENTS against command names
- Contains dynamic STATE.md injection
- Contains "New here?" footer for NO_PROJECT
- undo command is in the "Build" group
- ideas (plural) is in the "Other" group
- No jargon words in user-facing text
  </verify>
  <done>
skills/help/SKILL.md lists all 12 commands in four groups (Blueprint, Build, Inspect, Other), includes topic-specific help mode via $ARGUMENTS matching command names, and shows detailed help with examples for each individual command. The undo command appears under Build with accurate description.
  </done>
</task>

</tasks>

<verification>
- skills/undo/SKILL.md exists with complete undo flow
- skills/help/SKILL.md lists all 12 commands including undo and ideas
- Help responds to topic-specific requests (e.g., $ARGUMENTS="build" shows build-specific help)
- Undo skill uses git reset --hard HEAD~1 (not git revert)
- Undo skill confirms before acting
- Undo skill warns on non-Director commits
- Undo skill logs to .director/undo.log
- No developer jargon in any user-facing message templates
</verification>

<success_criteria>
The undo skill exists as a complete, standalone skill file that Claude Code can register and invoke. The help skill accurately reflects all 12 Director commands with topic-specific help mode. Both skills follow Director's established patterns for tone, terminology, and structure.
</success_criteria>

<output>
After completion, create `.planning/phases/09-command-intelligence/09-01-SUMMARY.md`
</output>
