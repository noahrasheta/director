---
phase: 09-command-intelligence
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/inspect/SKILL.md
  - skills/build/SKILL.md
  - skills/blueprint/SKILL.md
  - skills/pivot/SKILL.md
  - skills/onboard/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Running /director:build with no .director/ folder routes to onboard instead of failing"
    - "Running /director:inspect with no vision routes to onboard conversationally"
    - "Running /director:onboard on already-onboarded project acknowledges existing vision and offers update or move on"
    - "All four key-entry commands (build, blueprint, inspect, pivot) use consistent four-step routing pattern"
    - "Partially complete states are detected and picked up where user left off"
  artifacts:
    - path: "skills/inspect/SKILL.md"
      provides: "Inspect skill with vision check added to routing"
      contains: "VISION.md"
    - path: "skills/build/SKILL.md"
      provides: "Build skill with verified routing consistency"
      contains: "director:onboard"
    - path: "skills/blueprint/SKILL.md"
      provides: "Blueprint skill with verified routing consistency"
      contains: "director:onboard"
    - path: "skills/pivot/SKILL.md"
      provides: "Pivot skill with verified routing consistency"
      contains: "director:onboard"
    - path: "skills/onboard/SKILL.md"
      provides: "Onboard skill with verified re-entry messaging"
      contains: "already have a vision"
  key_links:
    - from: "skills/inspect/SKILL.md"
      to: ".director/VISION.md"
      via: "vision template detection before completed-work check"
      pattern: "VISION\\.md"
    - from: "skills/build/SKILL.md"
      to: "skills/onboard/SKILL.md"
      via: "routing suggestion when vision is missing"
      pattern: "director:onboard"
---

<objective>
Audit and standardize routing across all key-entry commands, and add the missing vision check to inspect.

Purpose: The research identified that routing is already well-implemented but needs consistency audit. The one concrete gap is inspect missing a vision check -- it jumps straight to checking for completed work. This plan fixes that gap and ensures all four key-entry commands (build, blueprint, inspect, pivot) use exactly the same four-step routing pattern with consistent phrasing.

Output: Five updated skill files with consistent routing patterns.
</objective>

<execution_context>
@/Users/noahrasheta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/noahrasheta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-command-intelligence/09-CONTEXT.md
@.planning/phases/09-command-intelligence/09-RESEARCH.md
@skills/build/SKILL.md
@skills/blueprint/SKILL.md
@skills/inspect/SKILL.md
@skills/pivot/SKILL.md
@skills/onboard/SKILL.md
@reference/plain-language-guide.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add vision check to inspect and verify routing consistency across key-entry commands</name>
  <files>skills/inspect/SKILL.md, skills/build/SKILL.md, skills/blueprint/SKILL.md, skills/pivot/SKILL.md, skills/onboard/SKILL.md</files>
  <action>
This is an audit-then-fix task. Read all five skill files, compare their routing patterns, and make targeted updates.

**1. Add vision check to inspect (the one concrete gap):**

In skills/inspect/SKILL.md, add a new Step 1b between the existing Step 1 (init check) and Step 2 (check for completed work). The new step should be:

```
## Step 1b: Vision check

Read `.director/VISION.md`. Check whether it has real content beyond the default template.

**Template detection:** If the file contains placeholder text like `> This file will be populated when you run /director:onboard`, or italic prompts like `_What are you calling this project?_`, or headings with no substantive content beneath them (just blank lines, template markers, or italic instructions), the project has NOT been onboarded yet.

If VISION.md is template-only, say:

> "There's nothing to check yet -- we need to set up your project first. Want to start with `/director:onboard`?"

Wait for the user's response. If they agree, proceed as if they ran `/director:onboard`.

**Stop here if no vision.**
```

This uses the EXACT same template detection logic as build Step 2 and blueprint's template detection, and the EXACT same four-step routing pattern (state: "nothing to check yet", explain: "we need to set up your project first", suggest: "Want to start with /director:onboard?", wait: for response).

Renumber subsequent steps: current Step 2 becomes Step 2 (unchanged numbering since we used 1b), Step 3-7 stay the same.

**2. Audit routing consistency across build, blueprint, inspect, pivot:**

Read each skill's routing cascade and verify all four steps of the routing pattern are present for each routing scenario. The canonical four-step pattern (from decision 01-03):

1. State the situation
2. Explain why
3. Suggest the action conversationally ("Want to..." not "Run /director:...")
4. Wait for the user's response

For each skill, verify these routing scenarios use the four-step pattern:

**build:**
- No vision -> routes to onboard (Step 2) -- VERIFY four-step pattern present
- No gameplan -> routes to blueprint (Step 3) -- VERIFY four-step pattern present
- All tasks complete (Step 4, case 8) -- VERIFY messaging is conversational

**blueprint:**
- No vision -> routes to onboard -- VERIFY four-step pattern present
- Note: blueprint does NOT have a "no .director/" routing message -- it inits silently. This is correct per research. Do NOT add a routing message here.

**pivot:**
- No vision (1b) -> routes to onboard -- VERIFY four-step pattern present
- No gameplan (1c) -> routes to blueprint -- VERIFY four-step pattern present

**onboard:**
- Already-onboarded re-entry -- VERIFY messaging matches CMDI-03: "acknowledge the existing vision and offer a choice (update it or move on to planning)." Per the locked decision, the user may have intentionally re-run onboard for a pivot or vision update.

**3. Fix any inconsistencies found:**

For each routing message that does NOT follow the four-step pattern, rewrite it to match. Use conversational phrasing per decision 01-04: "Want to..." not "Run /director:..."

Common consistency issues to check:
- Does each routing message explain WHY before suggesting? (not just "Run X")
- Does each routing message wait for user response? (not auto-execute)
- Are the suggestion phrases conversational? ("Want to..." not imperative)
- Are the template detection patterns identical across skills? (same placeholder strings)

**4. Verify partial-state detection (per locked decision):**

In build skill, verify that when all tasks in the gameplan are complete (Step 4, case 8), the message acknowledges completion and suggests inspect or blueprint -- not an error. This is already present ("Your project is done! Everything in the gameplan has been built. Want to review it with /director:inspect, or add more goals with /director:blueprint?") so just verify it's there.

**IMPORTANT constraints:**
- Do NOT add routing to lightweight commands (help, status, idea, brainstorm, quick, resume, ideas) -- per locked decision, state checks are only on key entry points (build, blueprint, inspect, pivot)
- Do NOT extract template detection into a shared utility -- skills are standalone Markdown
- Make MINIMAL changes -- this is an audit, not a rewrite. Only change lines that fail the consistency check
- Preserve all existing functionality in each skill
  </action>
  <verify>
For each of the five skills, verify:
1. skills/inspect/SKILL.md now has a vision check (Step 1b) with template detection matching build/blueprint/pivot
2. All routing messages in build (Steps 2, 3) follow four-step pattern
3. All routing messages in blueprint follow four-step pattern
4. All routing messages in pivot (Steps 1b, 1c) follow four-step pattern
5. Onboard re-entry (already-onboarded path) acknowledges existing vision and offers update-or-continue choice
6. Template detection strings are identical across all skills that use them (build, blueprint, inspect, pivot, onboard, brainstorm)
7. No routing was added to lightweight commands
  </verify>
  <done>
Inspect skill has vision check added between init and completed-work check. All four key-entry commands (build, blueprint, inspect, pivot) use the same four-step routing pattern with consistent phrasing. Onboard re-entry acknowledges existing vision per CMDI-03. Template detection patterns are consistent across all skills. No changes made to lightweight commands.
  </done>
</task>

</tasks>

<verification>
- Inspect skill routes to onboard when VISION.md is template-only (the one concrete gap from research)
- Build skill routes to onboard when no vision, to blueprint when no gameplan
- Blueprint skill routes to onboard when no vision
- Pivot skill routes to onboard when no vision, to blueprint when no gameplan
- Onboard skill acknowledges existing vision on re-entry per CMDI-03
- All routing messages use four-step pattern: state, explain, suggest conversationally, wait
- No routing added to lightweight commands (help, status, idea, brainstorm, quick, resume, ideas)
- No developer jargon in routing messages
</verification>

<success_criteria>
Every key-entry command detects project state and redirects conversationally when invoked out of sequence. The inspect skill's vision gap is closed. Routing patterns are consistent across all skills. CMDI-01, CMDI-02, and CMDI-03 requirements are satisfied.
</success_criteria>

<output>
After completion, create `.planning/phases/09-command-intelligence/09-02-SUMMARY.md`
</output>
